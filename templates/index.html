<!-- 既存のHTMLに以下を追加 -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

<script>
// ブラウザでMediaPipe Poseを初期化
const pose = new Pose({locateFile: (file) => {
  return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
}});

pose.setOptions({
  modelComplexity: 1,
  smoothLandmarks: true,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

// 結果をFlaskに送信する関数
function sendPoseResultsToServer(results) {
  fetch('/save_pose_results', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ landmarks: results.poseLandmarks }),
  })
  .then(response => response.json())
  .then(data => {
    console.log('Success:', data);
    analyzePosture(data.landmarks);
  });
}

// 姿勢分析の関数
function analyzePosture(landmarks) {
  // この部分で姿勢の角度計算とフィードバック生成
  // ...
}

// 画像が選択されたときにMediaPipeで処理
document.getElementById('imageInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  const reader = new FileReader();
  
  reader.onload = function() {
    const img = new Image();
    img.src = reader.result;
    
    img.onload = function() {
      pose.send({image: img}).then(results => {
        // 結果をサーバーに送信
        sendPoseResultsToServer(results);
      });
    }
  }
  
  reader.readAsDataURL(file);
});
</script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>
