<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏃 クラウチングスタート姿勢分析プロ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center my-4">🏃 クラウチングスタート姿勢分析プロ【超軽量版】</h1>
                <p class="text-center text-muted">🎯 手動関節点設定専用・確実デプロイ版</p>
            </div>
        </div>
        
        <div class="row">
            <!-- 左側：画像表示エリア -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>📷 画像アップロード＆関節点調整</h5>
                        <div>
                            <select class="form-select" id="adjustmentMode" style="width: 200px;">
                                <option value="click">❶ クリック選択</option>
                                <option value="direction">❷ 方向キー調整</option>
                                <option value="dropdown">❃ プルダウン選択</option>
                                <option value="batch">❹ 一括表示</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- ドラッグ&ドロップエリア -->
                        <div id="dropArea" class="drop-area mb-3">
                            <div class="drop-content">
                                <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #667eea;"></i>
                                <p class="mt-2">📁 ファイルをドラッグ&ドロップ または クリックして選択</p>
                                <p class="text-muted small">JPG, PNG, WEBP 対応 (最大16MB) 【手動関節点設定専用】</p>
                            </div>
                            <input type="file" class="form-control d-none" id="imageUpload" accept="image/*">
                        </div>
                        
                        <!-- 画像表示エリア -->
                        <div id="imageContainer" class="text-center position-relative">
                            <p class="text-muted">画像をアップロードしてください</p>
                        </div>
                        
                        <!-- キャンバス（画像上に関節点を描画） -->
                        <canvas id="imageCanvas" style="display: none; border: 2px solid #ddd; cursor: crosshair;"></canvas>
                        
                        <!-- 方向キーコントロール（方向キーモード時のみ表示） -->
                        <div id="directionControls" style="display: none;" class="mt-3">
                            <h6>🎯 方向キー調整</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>移動距離:</label>
                                    <select class="form-select" id="moveStep">
                                        <option value="1">1px</option>
                                        <option value="2">2px</option>
                                        <option value="5" selected>5px</option>
                                        <option value="10">10px</option>
                                    </select>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <div class="direction-pad">
                                    <div class="row">
                                        <div class="col-4"></div>
                                        <div class="col-4">
                                            <button class="btn btn-outline-primary w-100" id="moveUp">🔼</button>
                                        </div>
                                        <div class="col-4"></div>
                                    </div>
                                    <div class="row mt-1">
                                        <div class="col-4">
                                            <button class="btn btn-outline-primary w-100" id="moveLeft">◀️</button>
                                        </div>
                                        <div class="col-4">
                                            <!-- 中央部分は空にする -->
                                        </div>
                                        <div class="col-4">
                                            <button class="btn btn-outline-primary w-100" id="moveRight">▶️</button>
                                        </div>
                                    </div>
                                    <div class="row mt-1">
                                        <div class="col-4"></div>
                                        <div class="col-4">
                                            <button class="btn btn-outline-primary w-100" id="moveDown">🔽</button>
                                        </div>
                                        <div class="col-4"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 右側：コントロールパネル -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5>🎯 関節点調整</h5>
                    </div>
                    <div class="card-body">
                        <!-- 選択中の関節点表示 -->
                        <div class="alert alert-info" id="selectedJointInfo">
                            関節点を選択してください
                        </div>
                        
                        <!-- 関節点選択ボタン -->
                        <div class="mb-3" id="jointButtonsContainer">
                            <h6>関節点を選択:</h6>
                            <div class="d-grid gap-2" id="jointButtons">
                                <!-- JavaScriptで動的生成 -->
                            </div>
                        </div>
                        
                        <!-- プルダウン選択（プルダウンモード時のみ表示） -->
                        <div class="mb-3" id="dropdownSelection" style="display: none;">
                            <h6>関節点選択:</h6>
                            <select class="form-select" id="jointDropdown">
                                <!-- JavaScriptで動的生成 -->
                            </select>
                        </div>
                        
                        <!-- 数値入力調整 -->
                        <div class="mb-3" id="numericAdjustment" style="display: none;">
                            <h6>数値調整:</h6>
                            <div class="row">
                                <div class="col-6">
                                    <label class="form-label">X座標</label>
                                    <input type="number" class="form-control" id="xCoord">
                                </div>
                                <div class="col-6">
                                    <label class="form-label">Y座標</label>
                                    <input type="number" class="form-control" id="yCoord">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 一括調整（一括モード時のみ表示） -->
                        <div id="batchAdjustment" style="display: none;">
                            <h6>一括調整:</h6>
                            <div id="batchControls">
                                <!-- JavaScriptで動的生成 -->
                            </div>
                        </div>
                        
                        <!-- 分析モード選択 -->
                        <div class="mb-3">
                            <h6>分析モード:</h6>
                            <select class="form-select" id="analysisMode">
                                <option value="set">セット姿勢</option>
                                <option value="takeoff">飛び出し分析</option>
                            </select>
                        </div>
                        
                        <!-- 分析実行ボタン -->
                        <button class="btn btn-primary w-100 mb-3" id="analyzeBtn" disabled>
                            📊 姿勢分析実行
                        </button>
                        
                        <!-- 結果ダウンロードボタン -->
                        <button class="btn btn-success w-100 mb-3" id="downloadBtn" style="display: none;">
                            💾 結果をダウンロード
                        </button>
                        
                        <!-- 分析結果表示 -->
                        <div id="analysisResults">
                            <!-- 分析結果がここに表示される -->
                        </div>
                    </div>
                </div>
                
                <!-- グラフ表示エリア -->
                <div class="card mt-3" id="chartCard" style="display: none;">
                    <div class="card-header">
                        <h5>📊 角度グラフ</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="angleChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>