// 画像アップロード部分
fetch('/upload', {
    method: 'POST',
    body: formData
})
.then(response => {
    if (!response.ok) {
        throw new Error(`サーバーエラー: ${response.status}`);
    }
    return response.text();  // まずテキストとして取得
})
.then(text => {
    try {
        return JSON.parse(text);  // JSONとしてパース
    } catch (e) {
        console.error('JSONパースエラー:', e);
        console.error('受信テキスト:', text);
        throw new Error('サーバーからの応答を解析できませんでした');
    }
})
.then(data => {
    // 元のコード
    if (data.success) {
        // 成功処理
    } else {
        // エラー処理
    }
})
.catch(error => {
    // エラーハンドリング
    console.error('アップロードエラー:', error);
    // エラー表示処理
});
